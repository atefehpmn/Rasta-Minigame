<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Movable Gated Latch Builder</title>
<style>
  body { background:#f9f9f9; font-family:sans-serif; text-align:center; }
  #workspace {
    width:950px; height:500px; border:2px dashed #555;
    margin:20px auto; position:relative; background:white;
  }
  .component {
    width:110px; height:70px; background:#ddd; border:2px solid #333;
    position:absolute; cursor:move; border-radius:8px;
    display:flex; flex-direction:column; justify-content:center; align-items:center;
    user-select:none;
  }
  .port {
    width:12px; height:12px; background:black; border-radius:50%;
    position:absolute; cursor:pointer;
  }
  .output { right:-8px; top:50%; transform:translateY(-50%); }
  .input { left:-8px; }
  #message { margin-top:15px; font-size:20px; font-weight:bold; }
  svg { position:absolute; top:0; left:0; width:100%; height:100%; pointer-events:none; }
  line { stroke:black; stroke-width:2; }
  .val { font-weight:bold; }
</style>
</head>
<body>
<h2>Build and Test the Gated Latch</h2>

<div id="workspace">
  <svg id="wires"></svg>

  <div class="component inputComp" id="data" style="top:50px;left:20px;">
    Data <span id="data_val" class="val">(0)</span>
    <div class="output port" data-id="data"></div>
  </div>
  <div class="component inputComp" id="enable" style="top:150px;left:20px;">
    Enable <span id="enable_val" class="val">(0)</span>
    <div class="output port" data-id="enable"></div>
  </div>

  <div class="component" id="and1" style="top:100px;left:250px;">
    AND1
    <div class="input port" style="top:20%;" data-id="and1_in1"></div>
    <div class="input port" style="top:70%;" data-id="and1_in2"></div>
    <div class="output port" data-id="and1_out"></div>
  </div>

  <div class="component" id="not1" style="top:250px;left:250px;">
    NOT
    <div class="input port" style="top:50%;" data-id="not1_in"></div>
    <div class="output port" data-id="not1_out"></div>
  </div>

  <div class="component" id="and2" style="top:250px;left:450px;">
    AND2
    <div class="input port" style="top:20%;" data-id="and2_in1"></div>
    <div class="input port" style="top:70%;" data-id="and2_in2"></div>
    <div class="output port" data-id="and2_out"></div>
  </div>

  <div class="component" id="latch" style="top:150px;left:650px;">
    SR Latch
    <div class="input port" style="top:30%;" data-id="latch_in1"></div>
    <div class="input port" style="top:70%;" data-id="latch_in2"></div>
    <div class="output port" data-id="latch_out"></div>
  </div>
</div>

<div id="output">Output: <span id="out_val" class="val">(0)</span></div>
<div id="message"></div>

<script>
  const wires = document.getElementById("wires");
  let startPort = null;
  const connections = [];

  // state of signals
  let values = { data:0, enable:0, and1_out:0, not1_out:0, and2_out:0, latch_out:0 };
  let latchQ = 0; // SR latch internal state

  // === Draggable Components ===
  let selected = null, offsetX=0, offsetY=0;
  document.querySelectorAll('.component').forEach(c=>{
    c.onmousedown = e=>{
      if(e.target.classList.contains("port")) return; // allow port click
      selected = c;
      offsetX = e.offsetX; offsetY = e.offsetY;
    };
  });
  document.onmousemove = e=>{
    if(selected){
      selected.style.left = (e.pageX - offsetX - workspace.offsetLeft)+"px";
      selected.style.top = (e.pageY - offsetY - workspace.offsetTop)+"px";
      redrawWires();
    }
  };
  document.onmouseup = ()=>{ selected=null; };

  // === Input toggling ===
  document.querySelectorAll('.inputComp').forEach(comp=>{
    comp.onclick = ()=>{
      const id = comp.id;
      values[id] = values[id] ? 0 : 1;
      document.getElementById(id+"_val").textContent = "("+values[id]+")";
      updateLogic();
    };
  });

  // === Wire Connections ===
  function connect(p1, p2) {
    connections.push([p1.dataset.id, p2.dataset.id]);
    redrawWires();
    updateLogic();
  }

  function redrawWires(){
    wires.innerHTML="";
    connections.forEach(c=>{
      const p1=document.querySelector(`[data-id='${c[0]}']`);
      const p2=document.querySelector(`[data-id='${c[1]}']`);
      if(p1 && p2){
        const r1=p1.getBoundingClientRect();
        const r2=p2.getBoundingClientRect();
        const ws=workspace.getBoundingClientRect();
        const x1=r1.left+r1.width/2-ws.left;
        const y1=r1.top+r1.height/2-ws.top;
        const x2=r2.left+r2.width/2-ws.left;
        const y2=r2.top+r2.height/2-ws.top;
        const line=document.createElementNS("http://www.w3.org/2000/svg","line");
        line.setAttribute("x1",x1); line.setAttribute("y1",y1);
        line.setAttribute("x2",x2); line.setAttribute("y2",y2);
        wires.appendChild(line);
      }
    });
  }

  document.querySelectorAll('.port').forEach(p=>{
    p.onclick = (e)=>{
      e.stopPropagation();
      if(!startPort) startPort = p;
      else {
        if(startPort!==p) connect(startPort,p);
        startPort=null;
      }
    };
  });

  // === Logic Simulation ===
  function updateLogic(){
    const needed = [
      ["data","and1_in1"], ["enable","and1_in2"], ["and1_out","latch_in1"],
      ["data","not1_in"], ["not1_out","and2_in1"], ["enable","and2_in2"], ["and2_out","latch_in2"]
    ];
    const ok = needed.every(req =>
      connections.some(c=>(c[0]===req[0] && c[1]===req[1]) || (c[0]===req[1] && c[1]===req[0]))
    );
    if(!ok) { document.getElementById("message").textContent="❌ Not correct yet."; return; }

    // compute logic
    values.and1_out = values.data & values.enable;
    values.not1_out = values.data ^ 1;
    values.and2_out = values.not1_out & values.enable;

    // SR latch
    const S = values.and1_out;
    const R = values.and2_out;
    if(S && !R) latchQ=1;
    else if(!S && R) latchQ=0;
    values.latch_out=latchQ;

    document.getElementById("out_val").textContent="("+values.latch_out+")";
    document.getElementById("message").textContent="✅ Correct! Gated Latch Built!";
  }
</script>
</body>
</html>
