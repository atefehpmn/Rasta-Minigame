<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Gated Latch Builder — SVG Gates</title>
<style>
  body{margin:0;font-family:sans-serif;background:#f0f2f6}
  h2{text-align:center;margin:16px 0}
  #workspace{position:relative;width:1000px;height:600px;margin:0 auto;background:#fff;border:1px solid #ccc}
  svg#wires{position:absolute;inset:0}
  .wire{stroke:#666;stroke-width:2.5;fill:none;cursor:pointer}
  .wire.on{stroke:#0a0}
  .wirePreview{stroke:#ff7a00;stroke-dasharray:6 6;stroke-width:2.5;fill:none;pointer-events:none}
  .component{position:absolute;text-align:center;user-select:none}
  .gateShape{pointer-events:none}
  .label{margin-top:4px;font-size:13px}
  .port{width:14px;height:14px;border-radius:50%;border:1px solid #000;background:#888;position:absolute;cursor:crosshair}
  .port.on{background:#0a0}
  .port.off{background:#888}
</style>
</head>
<body>
<h2>Build the Gated Latch</h2>
<div id="workspace">
  <svg id="wires"></svg>

  <!-- Inputs -->
  <div class="component inputComp" id="data" style="left:40px;top:60px">
    <svg width="60" height="30" class="gateShape"><rect width="60" height="30" fill="#eee" stroke="#000"/></svg>
    <div class="port output off" data-id="data" style="right:-7px;top:50%;transform:translateY(-50%)"></div>
    <div class="label">DATA (<span id="data_val">0</span>)</div>
  </div>

  <div class="component inputComp" id="enable" style="left:40px;top:140px">
    <svg width="60" height="30" class="gateShape"><rect width="60" height="30" fill="#eee" stroke="#000"/></svg>
    <div class="port output off" data-id="enable" style="right:-7px;top:50%;transform:translateY(-50%)"></div>
    <div class="label">ENABLE (<span id="enable_val">0</span>)</div>
  </div>

  <!-- AND1 -->
  <div class="component" id="and1" style="left:220px;top:100px">
    <svg width="80" height="60" class="gateShape">
      <path d="M0,0 H40 A30,30 0 0 1 40,60 H0 Z" fill="#eee" stroke="#000"/>
    </svg>
    <div class="port input off" data-id="and1_in1" style="left:-7px;top:20%"></div>
    <div class="port input off" data-id="and1_in2" style="left:-7px;top:80%"></div>
    <div class="port output off" data-id="and1_out" style="right:-7px;top:50%"></div>
    <div class="label">AND</div>
  </div>

  <!-- NOT -->
  <div class="component" id="not1" style="left:220px;top:240px">
    <svg width="80" height="60" class="gateShape">
      <polygon points="0,0 60,30 0,60" fill="#eee" stroke="#000"/>
      <circle cx="65" cy="30" r="5" fill="#fff" stroke="#000"/>
    </svg>
    <div class="port input off" data-id="not1_in" style="left:-7px;top:50%"></div>
    <div class="port output off" data-id="not1_out" style="right:-7px;top:50%"></div>
    <div class="label">NOT</div>
  </div>

  <!-- AND2 -->
  <div class="component" id="and2" style="left:420px;top:240px">
    <svg width="80" height="60" class="gateShape">
      <path d="M0,0 H40 A30,30 0 0 1 40,60 H0 Z" fill="#eee" stroke="#000"/>
    </svg>
    <div class="port input off" data-id="and2_in1" style="left:-7px;top:20%"></div>
    <div class="port input off" data-id="and2_in2" style="left:-7px;top:80%"></div>
    <div class="port output off" data-id="and2_out" style="right:-7px;top:50%"></div>
    <div class="label">AND</div>
  </div>

  <!-- Latch -->
  <div class="component" id="latch" style="left:640px;top:140px">
    <svg width="100" height="80" class="gateShape"><rect width="100" height="80" fill="#eee" stroke="#000"/></svg>
    <div class="port input off" data-id="latch_in1" style="left:-7px;top:30%"></div>
    <div class="port input off" data-id="latch_in2" style="left:-7px;top:70%"></div>
    <div class="port output off" data-id="latch_out" style="right:-7px;top:50%"></div>
    <div class="label">Latch</div>
  </div>

  <!-- Display -->
  <div class="component" id="display" style="left:850px;top:220px">
    <svg width="70" height="40" class="gateShape"><rect width="70" height="40" fill="#eef" stroke="#000"/></svg>
    <div class="port input off" data-id="disp_in" style="left:-7px;top:50%"></div>
    <div class="label">OUTPUT (<span id="out_val">0</span>)</div>
  </div>
</div>

<div style="text-align:center;margin:12px;font-weight:bold" id="status">Wire the circuit like a gated latch. Click inputs to toggle.</div>

<script>
const workspace=document.getElementById('workspace'), wiresSVG=document.getElementById('wires');
let connections=[], previewPath=null, startPortEl=null, latchQ=0;
let values={data:0,enable:0,and1_out:0,not1_out:0,and2_out:0,latch_out:0,disp_in:0};

/* ---- helpers ---- */
function portCenter(el){
  const ws=workspace.getBoundingClientRect();
  const r=el.getBoundingClientRect();
  return {x:r.left+r.width/2-ws.left, y:r.top+r.height/2-ws.top};
}
function orthoPath(p1,p2){const midX=(p1.x+p2.x)/2;return`M${p1.x},${p1.y} L${midX},${p1.y} L${midX},${p2.y} L${p2.x},${p2.y}`;}

/* ---- wiring ---- */
document.querySelectorAll('.port').forEach(p=>{
  p.addEventListener('mousedown',e=>{
    e.stopPropagation();
    startPortEl=p; const c=portCenter(p);
    previewPath=document.createElementNS("http://www.w3.org/2000/svg","path");
    previewPath.setAttribute('class','wirePreview');
    previewPath.setAttribute('d',`M${c.x},${c.y}L${c.x},${c.y}`);
    wiresSVG.appendChild(previewPath);
  });
  p.addEventListener('mouseup',e=>{
    if(startPortEl&&startPortEl!==p){connections.push([startPortEl.dataset.id,p.dataset.id]);}
    if(previewPath){wiresSVG.removeChild(previewPath); previewPath=null;}
    startPortEl=null; redrawWires(); updateLogic();
  });
});
workspace.addEventListener('mousemove',e=>{
  if(previewPath){const ws=workspace.getBoundingClientRect(); const p2={x:e.clientX-ws.left,y:e.clientY-ws.top};
    updatePreview(p2);}
});
function updatePreview(p2){if(!previewPath)return;const c=previewPath.getAttribute('d').split(' ')[0].slice(1).split(',');
  const p1={x:+c[0],y:+c[1]}; previewPath.setAttribute('d',orthoPath(p1,p2));}
function redrawWires(){
  wiresSVG.innerHTML='';
  connections.forEach((c,i)=>{
    const p1=portCenter(document.querySelector(`[data-id='${c[0]}']`));
    const p2=portCenter(document.querySelector(`[data-id='${c[1]}']`));
    const path=document.createElementNS("http://www.w3.org/2000/svg","path");
    path.setAttribute('d',orthoPath(p1,p2)); path.setAttribute('class','wire');
    path.addEventListener('click',()=>{connections.splice(i,1);redrawWires();updateLogic();});
    wiresSVG.appendChild(path);
  });
}

/* ---- toggle inputs ---- */
document.querySelectorAll('.inputComp').forEach(comp=>{
  comp.addEventListener('click',e=>{
    if(e.target.classList.contains('port')) return;
    const id=comp.id; values[id]=values[id]?0:1;
    document.getElementById(id+"_val").textContent=values[id]; updateLogic();
  });
});

/* ---- logic ---- */
const REQUIRED=[["data","and1_in1"],["enable","and1_in2"],["and1_out","latch_in1"],
  ["data","not1_in"],["not1_out","and2_in1"],["enable","and2_in2"],["and2_out","latch_in2"],["latch_out","disp_in"]];
function isWired(a,b){return connections.some(c=>(c[0]===a&&c[1]===b)||(c[0]===b&&c[1]===a));}
function topologyOK(){return REQUIRED.every(([a,b])=>isWired(a,b));}

function updateLogic(){
  document.querySelectorAll('.port').forEach(p=>p.classList.remove('on','off'));
  document.getElementById('status').textContent="❌ Not correct yet.";
  if(!topologyOK()){redrawWires();return;}
  const D=values.data,E=values.enable;
  values.and1_out=D&E; values.not1_out=D^1; values.and2_out=values.not1_out&E;
  const S=values.and1_out,R=values.and2_out; if(S&&!R)latchQ=1; else if(!S&&R)latchQ=0;
  values.latch_out=latchQ; values.disp_in=latchQ;
  document.getElementById('out_val').textContent=values.disp_in;
  for(const k in values){const el=document.querySelector(`[data-id='${k}']`); if(el)el.classList.add(values[k]?'on':'off');}
  document.getElementById('status').textContent="✅ Correct wiring — latch works.";
  colorWires();
}
function wireSignal(c){return values[c[0]]||values[c[1]]||0;}
function colorWires(){[...wiresSVG.querySelectorAll('.wire')].forEach((w,i)=>wireSignal(connections[i])?w.classList.add('on'):w.classList.remove('on'));}
</script>
</body>
</html>
