<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>D Latch Simulator</title>
  <style>
    body {
      background: #222;
      color: white;
      font-family: Arial, sans-serif;
      display: flex;
      flex-direction: row;
      gap: 20px;
      padding: 20px;
    }
    .controls {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    button {
      padding: 10px;
      font-size: 16px;
      cursor: pointer;
      border-radius: 8px;
      border: none;
    }
    canvas {
      background: #fff;
      border: 2px solid black;
    }
  </style>
</head>
<body>
  <div class="controls">
    <h2>D Latch Controls</h2>
    <p><b>Enable (E):</b> <span id="enableVal">0</span></p>
    <button onclick="toggleEnable()">Toggle Enable</button>
    <p><b>D input:</b> <span id="dVal">0</span></p>
    <button onclick="toggleD()">Toggle D</button>
    <p><b>Latch Output (Q):</b> <span id="qVal">0</span></p>
  </div>

  <canvas id="waveform" width="600" height="200"></canvas>

<script>
let enable = 0;
let D = 0;
let Q = 0;

const enableVal = document.getElementById("enableVal");
const dVal = document.getElementById("dVal");
const qVal = document.getElementById("qVal");

const canvas = document.getElementById("waveform");
const ctx = canvas.getContext("2d");

// waveform buffers
let signals = {
  enable: [],
  D: [],
  Q: []
};
let t = 0;

// toggle functions
function toggleEnable() {
  enable = enable ? 0 : 1;
  updateLatch();
}
function toggleD() {
  D = D ? 0 : 1;
  updateLatch();
}

// update latch logic
function updateLatch() {
  if (enable === 1) {
    Q = D;
  }
  enableVal.textContent = enable;
  dVal.textContent = D;
  qVal.textContent = Q;
}

// draw waveforms
function drawWaveforms() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  // draw labels
  ctx.fillStyle = "black";
  ctx.font = "14px Arial";
  ctx.fillText("Enable", 10, 40);
  ctx.fillText("D", 10, 90);
  ctx.fillText("Q", 10, 140);

  // draw horizontal baselines
  drawSignal(signals.enable, 40, "blue");
  drawSignal(signals.D, 90, "red");
  drawSignal(signals.Q, 140, "green");
}

function drawSignal(data, y, color) {
  ctx.strokeStyle = color;
  ctx.beginPath();
  for (let i = 0; i < data.length; i++) {
    let x = i;
    let val = data[i];
    let level = val ? y - 20 : y;
    if (i === 0) {
      ctx.moveTo(x, level);
    } else {
      ctx.lineTo(x, level);
    }
  }
  ctx.stroke();
}

// simulation tick
function tick() {
  // record current values
  signals.enable.push(enable);
  signals.D.push(D);
  signals.Q.push(Q);

  // keep array within width
  if (signals.enable.length > canvas.width) {
    signals.enable.shift();
    signals.D.shift();
    signals.Q.shift();
  }

  drawWaveforms();
  t++;
  requestAnimationFrame(tick);
}

updateLatch();
tick();
</script>
</body>
</html>
