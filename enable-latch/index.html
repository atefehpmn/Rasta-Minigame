<!DOCTYPE html>
<html lang="fa">
<head>
  <meta charset="UTF-8">
  <title>شبیه‌ساز دی لچ</title>
  <!-- Load Vazirmatn font -->
  <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;600&display=swap" rel="stylesheet">
  <style>
    body {
      background: #fff;
      color: black;
      font-family: "Vazirmatn", sans-serif;
      display: flex;
      flex-wrap: wrap;   /* allow stacking on mobile */
      gap: 20px;
      padding: 10px;
      justify-content: center;
    }
    .canvas-container {
      flex: 1 1 100%;
      max-width: 100%;
      display: flex;
      justify-content: center;
    }
    canvas {
      background: #fff;
      width: 100%;       /* responsive */
      height: auto;
    }
    #waveform {
      border: 2px solid black;
      max-width: 100%;
    }
    @media (min-width: 700px) {
      .canvas-container {
        flex: 1 1 auto;
        max-width: 48%;  /* side by side on desktop */
      }
    }
  </style>
</head>
<body>
  <div class="canvas-container">
    <canvas id="schematic"></canvas>
  </div>
  <div class="canvas-container">
    <canvas id="waveform"></canvas>
  </div>

<script>
let enable = 0;
let D = 0;
let Q = 0;

const schematic = document.getElementById("schematic");
const sctx = schematic.getContext("2d");

const canvas = document.getElementById("waveform");
const ctx = canvas.getContext("2d");

let signals = { enable: [], D: [], Q: [] };

// Resize canvases dynamically for screen size
function resizeCanvases() {
  const ratio = window.devicePixelRatio || 1;

  // schematic
  schematic.width = schematic.clientWidth * ratio;
  schematic.height = 240 * ratio; // fixed height
  sctx.setTransform(ratio, 0, 0, ratio, 0, 0);

  // waveform
  canvas.width = canvas.clientWidth * ratio;
  canvas.height = 200 * ratio; // fixed height
  ctx.setTransform(ratio, 0, 0, ratio, 0, 0);
}
window.addEventListener("resize", resizeCanvases);
resizeCanvases();

// schematic drawing
function drawSchematic() {
  sctx.clearRect(0, 0, schematic.width, schematic.height);
  sctx.lineWidth = 3;
  sctx.font = "18px Vazirmatn";

  // داده
  sctx.strokeStyle = "black";
  sctx.strokeRect(20, 50, 40, 40);
  sctx.fillText("داده", 20, 40);
  sctx.fillStyle = D ? "limegreen" : "lightgray";
  sctx.fillRect(20, 50, 40, 40);
  sctx.fillStyle = "black";
  sctx.fillText(D, 35, 77);

  // فعال‌ساز
  sctx.strokeStyle = "black";
  sctx.strokeRect(20, 110, 40, 40);
  sctx.fillText("فعال‌ساز", 15, 170);
  sctx.fillStyle = enable ? "limegreen" : "lightgray";
  sctx.fillRect(20, 110, 40, 40);
  sctx.fillStyle = "black";
  sctx.fillText(enable, 35, 137);

  // لچ
  sctx.strokeStyle = "black";
  sctx.strokeRect(100, 40, 120, 120);
  sctx.fillText("دی لچ", 140, 100);

  // خروجی
  sctx.strokeStyle = "blue";
  sctx.strokeRect(250, 80, 40, 40);
  sctx.fillStyle = "black";
  sctx.fillText(Q, 265, 107);
  sctx.fillText("خروجی", 240, 70);

  // wires
  sctx.strokeStyle = "green";
  sctx.lineWidth = 3;
  sctx.beginPath();
  sctx.moveTo(60, 70); sctx.lineTo(100, 70);
  sctx.moveTo(60, 130); sctx.lineTo(100, 130);
  sctx.moveTo(220, 100); sctx.lineTo(250, 100);
  sctx.stroke();
}

function updateLatch() {
  if (enable === 1) Q = D;
  drawSchematic();
}

// clickable inputs (scaled for touch)
schematic.addEventListener("click", function(e) {
  const rect = schematic.getBoundingClientRect();
  const x = e.clientX - rect.left;
  const y = e.clientY - rect.top;

  if (x >= 20 && x <= 60 && y >= 50 && y <= 90) { // داده
    D = D ? 0 : 1;
    updateLatch();
  }
  if (x >= 20 && x <= 60 && y >= 110 && y <= 150) { // فعال‌ساز
    enable = enable ? 0 : 1;
    updateLatch();
  }
});

// waveform
function drawWaveforms() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  ctx.fillStyle = "black";
  ctx.font = "18px Vazirmatn";

  ctx.fillText("داده", 10, 55);
  ctx.fillText("فعال‌ساز", 10, 105);
  ctx.fillText("خروجی", 10, 155);

  drawSignal(signals.D, 40, "red");
  drawSignal(signals.enable, 90, "blue");
  drawSignal(signals.Q, 140, "green");
}

function drawSignal(data, y, color) {
  ctx.strokeStyle = color;
  ctx.lineWidth = 2.5;
  ctx.beginPath();
  for (let i = 0; i < data.length; i++) {
    let x = i;
    let val = data[i];
    let level = val ? y - 20 : y;
    if (i === 0) ctx.moveTo(x, level);
    else ctx.lineTo(x, level);
  }
  ctx.stroke();
}

// animation loop
function tick() {
  updateLatch();
  signals.enable.push(enable);
  signals.D.push(D);
  signals.Q.push(Q);

  if (signals.enable.length > canvas.width) {
    signals.enable.shift();
    signals.D.shift();
    signals.Q.shift();
  }

  drawWaveforms();
  requestAnimationFrame(tick);
}

updateLatch();
tick();
</script>
</body>
</html>
